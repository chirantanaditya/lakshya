---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header';
import Footer from '../../components/Footer';
import { getSession } from '../../lib/session';
import { db } from '../../db';
import { blogPosts } from '../../db/schema';
import { eq } from 'drizzle-orm';

const session = await getSession(Astro.cookies);
const slug = Astro.params.slug;

if (!slug) {
  return Astro.redirect('/blog');
}

const [post] = await db
  .select()
  .from(blogPosts)
  .where(eq(blogPosts.slug, slug))
  .limit(1);

if (!post) {
  return Astro.redirect('/blog');
}
---

<BaseLayout 
  title={post.metaTitle || post.name}
  description={post.metaDescription || post.postSummary || ''}
>
  <Header client:load session={session} />
  
  <main class="min-h-screen py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <article class="max-w-4xl mx-auto bg-white rounded-lg shadow p-8 md:p-12">
        <a href="/blog" class="text-primary-600 hover:underline mb-6 inline-block">
          ← Back to Blog
        </a>
        
        <h1 class="text-4xl font-bold text-gray-900 mb-6">{post.name}</h1>
        
        {post.mainImage && (
          <img 
            src={post.mainImage} 
            alt={post.altTextForSeo || post.name}
            class="w-full h-auto rounded-lg mb-8"
          />
        )}
        
        {post.postBody && (
          <div 
            class="prose max-w-none"
            set:html={post.postBody}
          />
        )}
        
        <div class="mt-8 pt-6 border-t border-gray-200">
          <a 
            href="/blog" 
            class="text-primary-600 hover:underline"
          >
            ← Back to Blog
          </a>
        </div>
      </article>
    </div>
  </main>
  
  <Footer client:load />
</BaseLayout>


